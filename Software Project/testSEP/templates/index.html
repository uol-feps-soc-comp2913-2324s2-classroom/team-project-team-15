<!DOCTYPE html>
<html>
<head>
    <title>Route Finder</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC_IDAXXGAVJYlMrrRt6gpBDhumrkQ-CbY"></script>
    <script>
        var directionsService;
        var directionsRenderer;
        var map;

        function initMap() {
            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer();

            // Try to get the user's current location
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    var userLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };

                    var mapOptions = {
                        zoom: 12,
                        center: userLocation
                    };

                    map = new google.maps.Map(document.getElementById('map'), mapOptions);
                    directionsRenderer.setMap(map);
                }, function() {
                    // If the user's location is not available, use a default location
                    var defaultLocation = { lat: 53.80815489338595, lng: -1.5439173678765745};
                    var mapOptions = {
                        zoom: 7,
                        center: defaultLocation
                    };

                    map = new google.maps.Map(document.getElementById('map'), mapOptions);
                    directionsRenderer.setMap(map);
                });
            } else {
                // If the browser doesn't support Geolocation API
                var defaultLocation = { lat: 53.80815489338595, lng: -1.5439173678765745};
                var mapOptions = {
                    zoom: 7,
                    center: defaultLocation
                };

                map = new google.maps.Map(document.getElementById('map'), mapOptions);
                directionsRenderer.setMap(map);
            }
        }

        function calculateRoute() {
            var origin = document.getElementById('origin').value;
            var destination = document.getElementById('destination').value;
            var travelMode = document.getElementById('travel-mode').value;
            var request = {
                origin: origin,
                destination: destination,
                travelMode: travelMode
            };
            directionsService.route(request, function(result, status) {
                if (status == 'OK') {
                    directionsRenderer.setDirections(result);
                    var totalDistance = 0;
                    var totalDuration = 0;
                    var legs = result.routes[0].legs;
                    for (var i = 0; i < legs.length; ++i) {
                        totalDistance += legs[i].distance.value;
                        totalDuration += legs[i].duration.value;
                    }
                    totalDistance = totalDistance / 1000; // Convert meters to kilometers
                    document.getElementById('total-distance').innerHTML = 'Total Distance: ' + totalDistance.toFixed(2) + ' km';
                    document.getElementById('total-duration').innerHTML = 'Total Time: ' + formatDuration(totalDuration);
                }
            });
            
        }

        function formatDuration(seconds) {
            var hours = Math.floor(seconds / 3600);
            var minutes = Math.floor((seconds % 3600) / 60);
            var remainingSeconds = seconds % 60;
            var formattedDuration = hours + " hour(s) " + minutes + " minute(s) " + remainingSeconds + " second(s)";
            return formattedDuration;
        }
    </script>
    <style>
        #map {
            height: 400px;
            width: 100%;
        }
    </style>
</head>
<body onload="initMap()">
    <h1>Route Finder</h1>
    <form method="post" onsubmit="calculateRoute(); return false;">
        <label for="origin">Origin:</label>
        <input type="text" id="origin" name="origin" required>
        <br>
        <label for="destination">Destination:</label>
        <input type="text" id="destination" name="destination" required>
        <br>
        <label for="travel-mode">Travel Mode:</label>
        <select id="travel-mode" name="travel-mode">
            <option value="BICYCLING">Cycling</option>
            <option value="WALKING">Walking</option>
        </select>
        <br>
        <input type="submit" value="Find Route">
    </form>

    <div id="map"></div>

    <h2 id="total-distance"></h2>
    <h2 id="total-duration"></h2>

    {% if route %}
    <h2>Route:</h2>
    <ol>
        {% for step in route %}
        <li>{{ step['html_instructions'] }}</li>
        {% endfor %}
    </ol>
    {% endif %}
</body>
</html>